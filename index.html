<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 ä¸™åˆé¦¬å¹´è³€æ­² - æ„›ç›Ÿå®¶åº­æ–‡æ•™åŸºé‡‘æœƒ</title>
   <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQNL3HG75Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WQNL3HG75Z');
</script>
    <!-- è¼‰å…¥å¿…è¦å¥—ä»¶ CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fcf8f2;
            -webkit-tap-highlight-color: transparent;
            margin: 0; padding: 0;
            overflow-x: hidden;
            width: 100%;
        }

        /* å„²å­˜æç¤ºå‹•ç•« */
        @keyframes handPulse {
            0%, 100% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(8px) scale(0.9); opacity: 0.8; }
        }
        .animate-hand {
            animation: handPulse 1.5s infinite ease-in-out;
        }

        .saveable-image {
            -webkit-touch-callout: default !important;
            user-select: none;
            cursor: pointer;
            width: 100%;
            display: block;
            border-radius: 2rem;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.3);
        }

        #render-canvas {
            position: fixed;
            left: -9999px;
            top: 0;
            opacity: 0.01;
            pointer-events: none;
        }
        
        /* å…¨åŸŸå¼·åˆ¶ç½®ä¸­è¼”åŠ© */
        .flex-center-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            text-align: center;
        }

        /* ç…§ç‰‡é è¦½è£åˆ‡æ¡† */
        .crop-wrapper {
            width: 100%;
            max-width: 320px;
            position: relative;
            background: #f1f5f9;
            border: 4px solid #fff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-radius: 1.5rem;
            overflow: hidden;
            touch-action: none;
        }
        .crop-aspect-ratio {
            padding-bottom: 143.75%; /* 1150 / 800 */
        }
        .crop-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center center;
            pointer-events: none;
            user-select: none;
            max-width: none;
        }
        .crop-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            border: 40px solid rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // ============================================================
        // ğŸ–¼ï¸ åœ–ç‰‡é€£çµå®šç¾©å€
        // ============================================================
        const HEADER_IMG_URL = "https://raw.githubusercontent.com/belovedraod/HorseYearsCard/main/new_horse.png"; 
        const CENTER_SEAL_URL = "https://img.freepik.com/free-vector/polygonal-shape-collection_23-2148197711.jpg"; 
        const LEFT_DECO_URL = "https://raw.githubusercontent.com/belovedraod/HorseYearsCard/main/new_horse-left.png"; 
        const RIGHT_DECO_URL = "https://raw.githubusercontent.com/belovedraod/HorseYearsCard/main/new_horse-right.png"; 

        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => { 
                if (window.lucide) {
                    try { lucide.createIcons(); } catch(e) {}
                } 
            }, [name]);
            return <span className="inline-block"><i data-lucide={name} style={{ width: size, height: size }} className={className}></i></span>;
        };

        const App = () => {
            const [step, setStep] = useState(1);
            const [userName, setUserName] = useState('');
            const [selectedBlessing, setSelectedBlessing] = useState('');
            const [customInput, setCustomInput] = useState('');
            const [userImage, setUserImage] = useState(null);
            
            const [scale, setScale] = useState(1);
            const [position, setPosition] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
            
            const [isGenerating, setIsGenerating] = useState(false);
            const [finalImageUrl, setFinalImageUrl] = useState('');
            const canvasRef = useRef(null);

            const presetBlessings = [
                "é¦¬ä¸Šæœ‰éŒ¢ è²¡æºå»£é€²", "æ„›è¿æ–°æ­² å¯Œæ½¤æµå¹´", "ç¦é¦¬å ±å–œ å¿ƒæƒ³äº‹æˆ",
                "æ„›æœ‰æ‰€æ­¸ å¹¸ç¦é•·å­˜", "æ„›ä¸­åŒè¡Œ å–œæ¨‚ç›¸ä¼´", "è¬é¦¬å¥”é¨° æ——é–‹å¾—å‹",
                "å…ƒæ°£æ»¿æ»¿ æ—¥æ—¥å®‰åº·", "å¿ƒå¯¬é«”å¥ æ­²æ­²å¹³å®‰", "é§¿é¦¬å¼•è·¯ è²´äººç›¸éš¨"
            ];

            const handleSelectBlessing = (text) => {
                setSelectedBlessing(text);
                setStep(2);
            };

            const handleCustomConfirm = () => {
                if (customInput.trim()) {
                    setSelectedBlessing(customInput);
                    setStep(2);
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => { 
                        setUserImage(event.target.result); 
                        setScale(1);
                        setPosition({ x: 0, y: 0 });
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleStart = (e) => {
                setIsDragging(true);
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                setDragStart({ x: clientX - position.x, y: clientY - position.y });
            };
            const handleMove = (e) => {
                if (!isDragging) return;
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                setPosition({ x: clientX - dragStart.x, y: clientY - dragStart.y });
            };
            const handleEnd = () => setIsDragging(false);

            useEffect(() => {
                const generateCard = async () => {
                    if (step === 3 && canvasRef.current && userImage && selectedBlessing) {
                        setIsGenerating(true);
                        const canvas = canvasRef.current;
                        const ctx = canvas.getContext('2d');
                        
                        const loadImage = (src) => {
                            return new Promise((resolve) => {
                                const img = new Image();
                                img.crossOrigin = "anonymous"; 
                                img.src = src;
                                img.onload = () => resolve(img);
                                img.onerror = () => resolve(null);
                            });
                        };

                        try {
                            const [userImg, leftImg, rightImg, sealBgImg] = await Promise.all([
                                loadImage(userImage),
                                loadImage(LEFT_DECO_URL),
                                loadImage(RIGHT_DECO_URL),
                                loadImage(CENTER_SEAL_URL)
                            ]);

                            drawFinalCard(ctx, canvas, userImg, leftImg, rightImg, sealBgImg);
                            
                            setTimeout(() => {
                                const dataUrl = canvas.toDataURL('image/png');
                                setFinalImageUrl(dataUrl);
                                setIsGenerating(false);
                            }, 1500);
                        } catch (error) {
                            console.error("ç”ŸæˆéŒ¯èª¤:", error);
                            setIsGenerating(false);
                        }
                    }
                };
                generateCard();
            }, [step]);

            const drawFinalCard = (ctx, canvas, userImg, leftImg, rightImg, sealBgImg) => {
                canvas.width = 1000;
                canvas.height = 2200;

                ctx.fillStyle = '#fdfbf7'; 
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ä¸»è¦èƒŒæ¿èˆ‡é‡‘è‰²æ¡†
                ctx.save();
                ctx.globalAlpha = 0.95; ctx.fillStyle = '#C8102E'; 
                drawRect(ctx, 40, 50, 920, 2100, 60); ctx.fill(); ctx.restore();

                ctx.save();
                ctx.strokeStyle = 'rgba(253, 230, 138, 0.7)'; ctx.lineWidth = 12; ctx.setLineDash([20, 15]);
                drawRect(ctx, 70, 80, 860, 2040, 40); ctx.stroke(); ctx.restore();

                // 3. ç…§ç‰‡ä½ˆå±€ (1150px é«˜)
                if (userImg) {
                    const px = 50, py = 140, pw = 900, ph = 1150;
                    ctx.save(); 
                    drawRect(ctx, px, py, pw, ph, 50); 
                    ctx.clip(); 
                    
                    const baseWidth = userImg.width;
                    const baseHeight = userImg.height;
                    const imgRatio = baseWidth / baseHeight;
                    const targetRatio = pw / ph;
                    
                    let drawW, drawH;
                    if (imgRatio > targetRatio) { 
                        drawH = ph; drawW = baseWidth * (ph / baseHeight); 
                    } else { 
                        drawW = pw; drawH = baseHeight * (pw / baseWidth); 
                    }
                    
                    const previewBoxWidth = 320; 
                    const scaleFactor = pw / previewBoxWidth;
                    const centerX = px + pw / 2;
                    const centerY = py + ph / 2;
                    
                    ctx.translate(centerX + position.x * scaleFactor, centerY + position.y * scaleFactor);
                    ctx.scale(scale, scale);
                    ctx.drawImage(userImg, -drawW / 2, -drawH / 2, drawW, drawH);
                    
                    ctx.restore(); 
                }

                ctx.setTransform(1, 0, 0, 1, 0, 0); 
                ctx.beginPath();
                ctx.globalAlpha = 1.0;
                ctx.setLineDash([]);
                ctx.globalCompositeOperation = 'source-over';

                // 4. æ–‡å­—ä½ˆå±€
                ctx.fillStyle = '#FDE68A'; 
                ctx.textAlign = 'center';
                
                // å…«å­—è³€è©
                ctx.font = 'bold 95px "Noto Sans TC", sans-serif'; 
                ctx.fillText(selectedBlessing, 500, 1400);
                
                // 2026 ä¸™åˆé¦¬å¹´
                ctx.font = 'bold 44px "Noto Sans TC", sans-serif'; 
                ctx.fillText(`2026 ä¸™åˆé¦¬å¹´`, 500, 1480);
                
                // ç½²å
                if (userName) { 
                    ctx.font = 'bold 52px "Noto Sans TC", sans-serif'; 
                    ctx.fillText(`${userName} æ•¬è³€`, 500, 1570); 
                }

                // ğŸš€ 5. å°ç« èˆ‡æ’åœ–ä½ˆå±€ (ä¸Šç§» 70px)
                const stampY = 1780; // åŸ 1850 -> 1780
                
                if (sealBgImg) {
                    const sSize = 240; 
                    ctx.drawImage(sealBgImg, 500 - sSize/2, stampY - sSize/2, sSize, sSize);
                } else {
                    drawSealShape(ctx, 500, stampY, 75, '#FDE68A');
                }

                const luckText = ["ç¥¥é¦¬ç»ç‘", "é¦¬åˆ°æˆåŠŸ", "é¾é¦¬ç²¾ç¥", "ä¸€é¦¬ç•¶å…ˆ"].find(t => !selectedBlessing.includes(t)) || "ç¥¥é¦¬ç»ç‘";
                ctx.fillStyle = '#BE123C'; ctx.font = 'bold 36px "Noto Sans TC", sans-serif';
                ctx.fillText(luckText[0], 480, stampY - 5); ctx.fillText(luckText[1], 520, stampY - 5);
                ctx.fillText(luckText[2], 480, stampY + 35); ctx.fillText(luckText[3], 520, stampY + 35);

                // å·¦å´æ’åœ– (éš¨ stampY ä¸Šç§»)
                if (leftImg) {
                    const lSize = 360;
                    ctx.drawImage(leftImg, 60, stampY - 220, lSize, lSize);
                }
                // å³å´æ’åœ– (éš¨ stampY ä¸Šç§»)
                if (rightImg) {
                    const rSize = 300;
                    ctx.drawImage(rightImg, 680, stampY - 80, rSize, rSize); 
                }

                // ğŸš€ 6. é å°¾è³‡è¨Š (ä¸Šç§»è‡³ 1980pxï¼Œé¨°å‡ºåº•éƒ¨çš„ç©ºé–“)
                const footerY = 1980; 
                ctx.fillStyle = '#e6e39c';
                ctx.font = 'bold 36px "Noto Sans TC", sans-serif'; 
                ctx.fillText("Â© 2026 æ„›ç›Ÿå®¶åº­æ–‡æ•™åŸºé‡‘æœƒ", 500, footerY);
                ctx.font = 'bold 32px "Noto Sans TC", sans-serif'; 
                ctx.fillText("ç‚ºæ„›å­¸ç¿’æŒçºŒç·´ç¿’ï¼Œæ˜¯ä¸€ä»¶å¹¸ç¦çš„äº‹", 500, footerY + 60);
            };

            function drawRect(ctx, x, y, w, h, r) {
                ctx.beginPath();
                ctx.moveTo(x + r, y);
                ctx.lineTo(x + w - r, y);
                ctx.quadraticCurveTo(x + w, y, x + w, y + r);
                ctx.lineTo(x + w, y + h - r);
                ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                ctx.lineTo(x + r, y + h);
                ctx.quadraticCurveTo(x, y + h, x, y + h - r);
                ctx.lineTo(x, y + r);
                ctx.quadraticCurveTo(x, y, x + r, y);
                ctx.closePath();
            }

            function drawSealShape(ctx, x, y, r, color) {
                ctx.save(); ctx.globalAlpha = 0.9; ctx.fillStyle = color; ctx.beginPath();
                for(let i=0; i<8; i++) {
                    const angle = (i/8) * Math.PI * 2;
                    const rr = r + (Math.random() * 8 - 4);
                    const px = x + Math.cos(angle) * rr;
                    const py = y + Math.sin(angle) * rr;
                    if(i===0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
                }
                ctx.closePath(); ctx.fill(); ctx.restore();
            }

            const handleShare = async () => {
                if (navigator.share && finalImageUrl) {
                    try {
                        const blob = await (await fetch(finalImageUrl)).blob();
                        const file = new File([blob], 'Greeting2026.png', { type: 'image/png' });
                        await navigator.share({ 
                            files: [file], 
                            title: 'æ­è³€æ–°ç¦§ï¼é€æ‚¨ä¸€å¼µé¦¬å¹´è³€å¡ï¼',
                            text: `æ­è³€æ–°ç¦§ï¼é€ä¸Šä»Šå¹´çš„ç¥ç¦ï¼\n\né‚€è«‹æ‚¨ä¹Ÿä¾†è£½ä½œæ‚¨çš„é¦¬å¹´è³€å¡ï¼šhttps://belovedraod.github.io/HorseYearsCard/`
                        });
                    } catch (err) { console.log('åˆ†äº«å·²å–æ¶ˆ'); }
                }
            };

            return (
                <div className="min-h-screen pb-12 select-none flex flex-col items-center w-full">
                    <canvas ref={canvasRef} id="render-canvas" />

                    <header className="bg-red-800 text-yellow-100 pt-12 pb-16 px-6 text-center relative shadow-xl overflow-hidden w-full flex-center-col">
                        <div className="relative z-10 flex flex-center-col gap-2">
                            <div className="animate-bounce">
                                <div className="w-32 h-32 flex items-center justify-center overflow-hidden rounded-full bg-white/20 p-2 border-4 border-white/30 shadow-2xl">
                                    <img src={HEADER_IMG_URL} alt="Hero" className="max-w-full max-h-full object-contain" />
                                </div>
                            </div>
                            <h1 className="text-4xl font-bold tracking-[0.2em] w-full">2026 ä¸™åˆé¦¬å¹´</h1>
                            <p className="text-red-100 mt-2 text-xl font-medium tracking-widest bg-white/10 px-6 py-1 rounded-full border border-white/20 backdrop-blur-sm">æ‰‹ç¹ªæ’ç•«æ„Ÿæ‹œå¹´è³€å¡</p>
                        </div>
                    </header>

                    <main className="max-w-xl mx-auto p-5 -mt-6 relative z-20 w-full flex-center-col">
                        <div className="flex items-center justify-around mb-12 bg-white/80 backdrop-blur p-4 rounded-3xl shadow-sm border border-red-50 w-full max-w-sm">
                            {[1, 2, 3].map((num) => (
                                <div key={num} className={`w-12 h-12 rounded-2xl flex items-center justify-center font-bold text-xl transition-all ${step === num ? 'bg-red-600 text-white scale-110 shadow-lg' : step > num ? 'bg-red-100 text-red-700' : 'bg-white border-2 border-red-50 text-red-100'}`}>{num}</div>
                            ))}
                        </div>

                        {step === 1 && (
                            <div key="step-1" className="animate-in fade-in slide-in-from-bottom-8 duration-500 flex-center-col space-y-8 w-full min-h-[400px]">
                                <div className="w-full bg-white/60 p-6 rounded-[2.5rem] border-2 border-red-100 shadow-sm flex-center-col space-y-4">
                                    <label className="text-xl font-bold text-slate-700 flex items-center gap-2"><Icon name="user" size={24} className="text-red-500" />æƒ³è¦åœ¨è³€å¡ä¸Šå°ä»€éº¼ç½²åï¼Ÿ</label>
                                    <input 
                                        type="text" 
                                        value={userName} 
                                        onChange={(e) => setUserName(e.target.value)} 
                                        placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜" 
                                        className="w-full p-4 text-xl bg-white border-2 border-red-200 rounded-2xl focus:outline-none focus:border-red-500 transition-colors shadow-inner text-center" 
                                    />
                                </div>
                                <h2 className="text-2xl font-bold text-slate-800 mb-2 font-serif w-full text-center">è«‹é¸æ“‡ä¸€å¥å–œæ­¡çš„è³€è©ï¼š</h2>
                                <div className="grid grid-cols-1 gap-3 w-full max-w-md">
                                    {presetBlessings.map((blessing, idx) => (
                                        <button key={idx} onClick={() => handleSelectBlessing(blessing)} className="w-full p-5 bg-white border-2 border-red-100 rounded-3xl text-xl font-bold text-red-800 hover:bg-red-50 hover:border-red-400 transition-all active:scale-95 shadow-sm text-center">
                                            {blessing}
                                        </button>
                                    ))}
                                    <div className="bg-red-50 p-6 rounded-[2.5rem] border-2 border-dashed border-red-200 flex-center-col space-y-4 mt-2 shadow-inner w-full">
                                        <p className="text-lg font-bold text-red-900 w-full text-center">æˆ–æ˜¯ä½ æƒ³è‡ªå·±å¯«ç¥è³€è©ï¼ˆ8å­—å…§ï¼‰ï¼š</p>
                                        <div className="flex gap-2 w-full flex-col">
                                            <input 
                                                type="text" 
                                                maxLength={9}
                                                value={customInput}
                                                onChange={(e) => setCustomInput(e.target.value)}
                                                placeholder="è¼¸å…¥è‡ªè¨‚å…§å®¹..."
                                                className="flex-1 p-4 text-lg border-2 border-red-200 rounded-2xl focus:outline-none focus:border-red-500 shadow-sm text-center"
                                            />
                                            <button onClick={handleCustomConfirm} className="bg-red-600 text-white px-8 rounded-2xl font-bold shadow-md active:scale-95 transition-transform">ç¢ºå®š</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {step === 2 && (
                            <div key="step-2" className="animate-in fade-in slide-in-from-bottom-8 duration-500 flex-center-col space-y-8 w-full min-h-[400px]">
                                <h2 className="text-2xl font-bold text-center text-slate-800 font-serif leading-relaxed px-4">
                                    ç‚ºè³€å¹´å¡æŒ‘é¸ä¸€å¼µç…§ç‰‡<br/>
                                    <span className="text-lg text-red-600 font-sans">ï¼ˆè³€å¡ç‚ºç›´å¼ï¼Œå»ºè­°æŒ‘é¸ç›´å¼ç…§ç‰‡æ•ˆæœæ›´å¥½å”·ï¼ï¼‰</span>
                                </h2>
                                
                                {!userImage ? (
                                    <div className="relative group mx-auto w-full max-w-sm">
                                        <input type="file" accept="image/*" onChange={handleFileUpload} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                                        <div className="bg-white aspect-[3/4.3] rounded-[3.5rem] shadow-xl border-4 border-dashed border-red-100 flex flex-center-col justify-center gap-6 group-hover:border-red-400 transition-colors p-10">
                                            <div className="w-24 h-24 bg-red-50 rounded-full flex items-center justify-center"><Icon name="camera" size={48} className="text-red-500" /></div>
                                            <p className="text-2xl font-bold text-slate-700">é»æ“Šä¸Šå‚³ç…§ç‰‡</p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="w-full flex-center-col space-y-6">
                                        <div 
                                            className="crop-wrapper"
                                            onMouseDown={handleStart}
                                            onMouseMove={handleMove}
                                            onMouseUp={handleEnd}
                                            onMouseLeave={handleEnd}
                                            onTouchStart={handleStart}
                                            onTouchMove={handleMove}
                                            onTouchEnd={handleEnd}
                                        >
                                            <div className="crop-aspect-ratio"></div>
                                            <img 
                                                src={userImage} 
                                                className="crop-image"
                                                style={{
                                                    width: '100%',
                                                    height: 'auto',
                                                    transform: `translate(-50%, -50%) translate(${position.x}px, ${position.y}px) scale(${scale})`
                                                }}
                                            />
                                            <div className="crop-overlay"></div>
                                        </div>
                                        
                                        <div className="w-full max-w-sm space-y-2 px-4">
                                            <div className="flex items-center justify-between text-slate-600 font-bold mb-1">
                                                <span>ç¸®æ”¾èª¿æ•´</span>
                                                <span>{Math.round(scale * 100)}%</span>
                                            </div>
                                            <input 
                                                type="range" 
                                                min="0.5" max="3" step="0.01" 
                                                value={scale} 
                                                onChange={(e) => setScale(parseFloat(e.target.value))}
                                                className="w-full h-4 bg-red-100 rounded-lg appearance-none cursor-pointer accent-red-600"
                                            />
                                            <p className="text-sm text-slate-400 mt-2">å¯ç”¨æ‰‹æŒ‡åœ¨æ¡†å…§æ‹–æ›³èª¿æ•´ç…§ç‰‡ä½ç½®</p>
                                        </div>

                                        <div className="flex gap-4 w-full max-w-sm px-4">
                                            <button onClick={() => setUserImage(null)} className="flex-1 py-4 bg-slate-100 text-slate-600 rounded-3xl font-bold active:scale-95 shadow-sm">é‡æ–°æŒ‘é¸</button>
                                            <button onClick={() => setStep(3)} className="flex-[2] py-4 bg-red-600 text-white rounded-3xl font-bold shadow-lg active:scale-95">ç¢ºå®šä½¿ç”¨æ­¤ä½ç½®</button>
                                        </div>
                                    </div>
                                )}
                                <button onClick={() => setStep(1)} className="text-slate-400 hover:text-red-700 font-bold text-xl flex items-center justify-center gap-2 mx-auto underline underline-offset-8 transition-colors pt-4"><Icon name="refresh-cw" size={20} /> é‡æ–°é¸è³€è©</button>
                            </div>
                        )}

                        {step === 3 && (
                            <div key="step-3" className="animate-in zoom-in-95 duration-700 flex flex-center-col space-y-10 w-full min-h-[400px]">
                                <h2 className="text-2xl font-bold text-red-900 flex items-center justify-center gap-2 font-serif w-full text-center"><Icon name="sparkles" size={24} className="text-yellow-600" /> æ‚¨çš„é¦¬å¹´å°ˆå±¬è³€å¡å®Œæˆå›‰ï¼</h2>
                                
                                <div className="relative group max-w-[90%] mx-auto w-full flex justify-center">
                                    <div className="relative shadow-2xl rounded-[3rem] overflow-hidden bg-white border-[12px] border-white ring-1 ring-black/5 w-full max-w-[400px]">
                                        {isGenerating ? (
                                            <div className="aspect-[1000/2200] w-full flex flex-center-col items-center justify-center gap-4 bg-slate-50/50">
                                                <div className="w-16 h-16 border-4 border-red-600 border-t-transparent rounded-full animate-spin"></div>
                                                <p className="font-bold text-red-800 text-xl tracking-widest animate-pulse text-center">ç¹ªè£½è³€å¡ä¸­...</p>
                                            </div>
                                        ) : (
                                            <img src={finalImageUrl} alt="Greeting Card" className="saveable-image" />
                                        )}
                                    </div>
                                </div>

                                <div className="space-y-6 flex flex-center-col w-full px-2">
                                    <div className="w-full max-w-sm bg-[#fefce8] border-2 border-dashed border-[#fde047] rounded-[2.5rem] p-6 text-center space-y-2 shadow-inner flex flex-center-col">
                                        <div className="flex justify-center"><Icon name="mouse-pointer-2" size={32} className="text-[#854d0e] animate-hand" /></div>
                                        <p className="text-[#451a03] text-xl font-bold tracking-wider w-full text-center">ã€é•·æŒ‰ä¸Šæ–¹åœ–ç‰‡ã€‘å³å¯å„²å­˜åˆ°ç›¸ç°¿</p>
                                        <p className="text-[#854d0e] text-lg font-medium w-full text-center">å„²å­˜å¾Œå¯çè—èˆ‡åˆ†äº«ï¼</p>
                                    </div>
                                    <button onClick={handleShare} className="w-full max-w-sm bg-[#449144] text-white py-6 rounded-[2.5rem] text-2xl font-bold shadow-[0_6px_0_0_#2d6a2d] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-3"><Icon name="share-2" size={28} /> é»æˆ‘ç›´æ¥ LINE/IG åˆ†äº«</button>
                                    <button onClick={() => {setStep(1); setUserName(''); setFinalImageUrl(''); setUserImage(null);}} className="text-[#475569] font-bold text-2xl py-4 tracking-[0.1em] hover:text-red-700 transition-colors w-full text-center">å†åšä¸€å¼µè³€å¹´å¡</button>
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="mt-16 px-8 max-w-xl mx-auto opacity-70 text-center space-y-6 pb-20 w-full flex-center-col">
                        <div className="h-px bg-slate-200 w-full"></div>
                        <p className="text-slate-500 font-light text-xl italic tracking-widest w-full text-center">2026 ä¸™åˆé¦¬å¹´ Â· ç¥¥é¦¬ç»ç‘ Â· é¦¬åˆ°æˆåŠŸ</p>
                        <div className="text-slate-400 font-light text-xl space-y-1 w-full text-center">
                            <p>Â© 2026 æ„›ç›Ÿå®¶åº­æ–‡æ•™åŸºé‡‘æœƒ</p>
                            <p>ç‚ºæ„›å­¸ç¿’æŒçºŒç·´ç¿’ï¼Œæ˜¯ä¸€ä»¶å¹¸ç¦çš„äº‹</p>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
